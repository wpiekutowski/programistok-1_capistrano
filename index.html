<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Capistrano</title>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  

  

  <script type="text/javascript">
  $(function(){
    setupPreso(false, './');
  });
  </script>
</head>

<body>


<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">&larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">z</td><td>toggle help (this)</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content" ref="one/01_intro/1">
<h1>Capistrano</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/01_intro/2">
<h1>Plan</h1>

<ul>
<li>WP</li>
<li>Zarz&#x105;dzanie wdro&#x17C;eniami</li>
<li>Capistrano</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/02_wp/1">
<h1>Wojciech Piekutowski</h1>

<ul>
<li>github.com/wpiekutowski</li>
<li>twitter.com/wpiekutowski</li>
<li>wojciech.piekutowski@amberbit.com</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content image center" ref="one/02_wp/2">
<p><img src="/programistok-1_capistrano/images/amberbit_logo.png" width="726" height="264" alt="AmberBit"/></p></div>
</div><div class="slide" data-transition="none"><div class="content image center" ref="one/02_wp/3">
<p><img src="/programistok-1_capistrano/images/office.jpg" width="720" height="540" alt="AmberBit"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/03_deploy/1">
<h1>Wdro&#x17C;enia - que?</h1>

<ul>
<li>pracuj&#x119; nad projektem bezpo&#x15B;rednio na serwerze!! ;)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/03_deploy/2">
<h1>Wdro&#x17C;enia - FTP :)</h1>

<ul>
<li>wy&#x15B;lij wszystkie pliki na serwer</li>
<li>statyczny HTML lub PHP z mod_php - bez   restartu</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/03_deploy/3">
<h1>Wdro&#x17C;enia - SSH</h1>

<ul>
<li>svn up/git pull</li>
<li>czasem potrzebny restart serwera</li>
<li>opuszczasz swoje &#x15B;rodowisko pracy</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/03_deploy/4">
<h1>Idealne narz&#x119;dzie...</h1>

<ul>
<li>jedna komenda!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/03_deploy/5">
<h1>Idealne narz&#x119;dzie...</h1>

<ul>
<li>powtarzalne wdro&#x17C;enia</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/03_deploy/6">
<h1>Idealne narz&#x119;dzie...</h1>

<ul>
<li>dla ka&#x17C;dego w zespole</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/03_deploy/7">
<h1>Idealne narz&#x119;dzie...</h1>

<ul>
<li>u&#x142;atwia skalowanie aplikacji</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/04_capistrano/1">
<h1>Capistrano</h1>

<ul>
<li>www.github.com/capistrano/capistrano</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/2">
<h1>platformy</h1>

<ul>
<li>Linux</li>
<li>Windows Server</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/3">
<h1>wymagania</h1>

<ul>
<li>SSH</li>
<li>jedno has&#x142;o do wszystkich serwer&#xF3;w</li>
<li>lub klucze publiczne</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="one/04_capistrano/4">
<h1>instalacja</h1>

<pre><code><code class="command">$ gem install capistrano</code><code class="result">
</code><code class="command">$ cd projects/beer_machine</code><code class="result">
</code><code class="command">$ capify .</code><code class="result">
[add] writing './Capfile'
[add] writing './config/deploy.rb'
[done] capified!
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/5">
<h1>Capfile</h1>

<ul>
<li>czyli Makefile, Rakefile</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/6">
<h1>git</h1>

<pre class="sh_ruby"><code>set :scm, "git"
set :repository,
  "git@amberbit.com:beer_machine.git"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/7">
<h1>svn</h1>

<pre class="sh_ruby"><code>set :scm, "svn"
set :repository,
  "svn+ssh://wojtek@svn.amberbit.com/beer_machine"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/8">
<h1>ga&#x142;&#x105;&#x17A; git/svn</h1>

<pre class="sh_ruby"><code>set :branch, "master"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/9">
<h1>modu&#x142;y git</h1>

<pre class="sh_ruby"><code>set :git_enable_submodules, 1</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/10">
<h1>strategia wdro&#x17C;enia</h1>

<pre class="sh_ruby"><code>set :deploy_via, :remote_cache
# or
set :deploy_via, :export</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/11">
<h1>app/deploy user</h1>

<pre class="sh_ruby"><code>set :user, "beer_machine"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/12">
<h1>gdzie?</h1>

<pre class="sh_ruby"><code>set :deploy_to, "/home/beer_machine/app"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/13">
<h1>historia</h1>

<pre class="sh_ruby"><code>set :keep_releases, 10</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/14">
<h1>serwer</h1>

<pre class="sh_ruby"><code>role :web, "beer-machine.com"
role :app, "beer-machine.com"
role :db,  "beer-machine.com", :primary =&gt; true</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/04_capistrano/15">
<h1>serwery (bigger than Google!)</h1>

<pre class="sh_ruby"><code>role :web, "beer-machine.com"
role :app,
  "app1.beer-machine.com", "app2.beer-machine.com"
role :db,
  "db1.beer-machine.com", :primary =&gt; true
role :db,
  "db2.beer-machine.com", "db3.beer-machine.com"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="one/04_capistrano/16">
<h1>ich pierwszy raz &#x2665;</h1>

<pre><code><code class="command">$ cap deploy:setup</code><code class="result">
/home/beer_machine/app
/home/beer_machine/app/releases
/home/beer_machine/app/shared
/home/beer_machine/app/shared/log
/home/beer_machine/app/shared/pids
/home/beer_machine/app/shared/system
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/17">
<h1>~/app/releases</h1>

<ul>
<li>zawiera kolejne wdro&#x17C;enia</li>
<li>~/app/releases/20110901201000</li>
<li>~/app/releases/20110903110415</li>
<li>~/app/releases/...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="one/04_capistrano/18">
<h1>pasy zapi&#x119;te?</h1>

<pre><code><code class="command">$ cap deploy:check</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="one/04_capistrano/19">
<h1>pierwsza aktualizacja kodu</h1>

<pre><code><code class="command">$ cap deploy:update</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/20">
<h1>deploy:update_code</h1>

<ul>
<li>pobierz najnowszy kod z git/svn</li>
<li>przejd&#x17A; na ga&#x142;&#x105;&#x17A;</li>
<li>skopiuj kod do app/releases/20110901191102</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/21">
<h1>deploy:finalize_update</h1>

<ul>
<li>ustaw dat&#x119; modyfikacji plik&#xF3;w na teraz</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="one/04_capistrano/22">
<h1>do dzie&#x142;a!</h1>

<pre><code><code class="command">$ cap deploy</code><code class="result">
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="one/04_capistrano/23">
<h1>deploy:symlink</h1>

<ul>
<li>stw&#xF3;rz link symboliczny app/current &#x2192; app/releases/20110901191102</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/04_capistrano/24">
<h1>deploy:restart</h1>

<ul>
<li>zrestartuj serwery aplikacji</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content image center" ref="one/04_capistrano/25">
<p><img src="/programistok-1_capistrano/images/message.jpg" width="720" height="540" alt="AmberBit"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/04_capistrano/26">
<h1>fail?</h1>

<ul>
<li>cap deploy:rollback</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="one/04_capistrano/27">
<h1>ssh?</h1>

<ul>
<li>cap shell</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content command" ref="one/04_capistrano/28">
<h1>config/deploy.rb</h1>

<pre class="sh_ruby"><code>set :scm, :git
set :repository, "git@amberbit.com:beer_machine.git"
set :branch, "v1.24.2"
set :deploy_via, :remote_cache
set :keep_releases, 10</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content command" ref="one/04_capistrano/29">
<h1>config/deploy.rb</h1>

<pre class="sh_ruby"><code>set :application, "beer_machine"
set :stage, "production"
set :user, "#{application}-#{stage}"
set :group, "#{application}-#{stage}"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content command" ref="one/04_capistrano/30">
<h1>config/deploy.rb</h1>

<pre class="sh_ruby"><code>role :web, "amberbit.com"
role :app, "amberbit.com"
role :db,  "amberbit.com", :primary =&gt; true
set :url, "beer-machine.amberbit.com"
set :deploy_to, "/home/#{user}/app"</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content command" ref="one/04_capistrano/31">
<h1>config/deploy.rb</h1>

<pre class="sh_ruby"><code>namespace :deploy do
  task :start do ; end
  task :stop do ; end

  desc "Restart passenger"
  task :restart, :roles =&gt; :app do
    file = File.join(current_path, 'tmp',
      'restart.txt')
    run "touch #{file}"
    run "curl #{fetch :url} &amp;"
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content command" ref="one/04_capistrano/32">
<h1>config/deploy.rb</h1>

<pre class="sh_ruby"><code>namespace :config do
  desc "Link shared configurations in release"
  task :link_shared_configurations, :roles =&gt; :app do
    files = %w[mongoid.yml application/config.yml]
    files.each do |f|
      from = "#{shared_path}/config/#{f}"
      to = "#{release_path}/config/#{f}"
      run "ln -nsf #{from} #{to}"
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content command" ref="one/04_capistrano/33">
<h1>config/deploy.rb</h1>

<pre class="sh_ruby"><code>after "deploy:update_code",
  "config:link_shared_configurations"
after "deploy:update_code",
  "deploy:cleanup" # remove old releases</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/outro/1">
<h1>Dzi&#x119;kuj&#x119; za uwag&#x119;</h1></div>
</div><div class="slide" data-transition="none"><div class="content" ref="one/outro/2">
<h1>Pytania?</h1></div>
</div></div>

</body>
</html>
